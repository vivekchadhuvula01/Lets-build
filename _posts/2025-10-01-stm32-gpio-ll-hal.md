---
layout: post
title: "Toggling and Controlling GPIO Pins in STM32 (LL vs HAL)"
subtitle: "A beginner-friendly guide using STM32F401 series"
tags: [stm32, embedded, gpio, hal, ll, c]
author: "Vivek Chadhuvula"
comments: true
mathjax: false
---

{: .box-success}
This post will help you **understand and control GPIO pins** on an STM32 microcontroller, specifically using the **STM32F401** series. Even if you’ve never worked with microcontrollers before, don’t worry — we’ll go step-by-step using both **HAL (Hardware Abstraction Layer)** and **LL (Low Level)** drivers.

---

##  What is a GPIO Pin?

{: .box-note}
**GPIO (General Purpose Input Output)** pins are the basic interface between your microcontroller and the outside world.  
They can **read** (as input) or **control** (as output) electronic signals such as turning an LED ON/OFF or reading a button press.

---

##  STM32 Development Environment Setup

To follow this tutorial, you’ll need:

| Tool | Purpose | Download |
| :---- | :---- | :---- |
| STM32CubeIDE | To write and compile the code | [Download here](https://www.st.com/en/development-tools/stm32cubeide.html) |
| STM32CubeMX | To configure peripherals easily | [Download here](https://www.st.com/en/development-tools/stm32cubemx.html) |
| STM32F401 Board | Example MCU (e.g., Nucleo-F401RE) | [Product link](https://www.st.com/en/evaluation-tools/nucleo-f401re.html) |

---

## Configure a GPIO Pin in CubeMX

1. Open **STM32CubeMX** and select your MCU — for example, `STM32F401RETx`.
2. Click on a pin (say **PA5**) and select **GPIO_Output**.
3. Under the **Configuration** tab, give it a name like `LED_PIN`.
4. Generate code for **STM32CubeIDE**.

{: .box-note}
By default, on the Nucleo-F401RE board, **PA5** is connected to the onboard **green LED**.

---

## Understanding HAL and LL Drivers

STM32 provides two major programming layers:

| Layer | Full Form | Description |
| :-- | :-- | :-- |
| **HAL** | Hardware Abstraction Layer | Easy-to-use, high-level API for beginners. |
| **LL** | Low Layer | More control and faster execution, but less user-friendly. |

---

##  Toggling GPIO using HAL

Let’s write code to blink the LED every 500ms using HAL drivers.

```c
#include "main.h"

int main(void)
{
  HAL_Init();
  SystemClock_Config();
  MX_GPIO_Init();  // Function auto-generated by CubeMX

  while (1)
  {
    HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5); // Toggle LED
    HAL_Delay(500); // 500ms delay
  }
}
```

<!-- ### What’s happening here? -->

- `HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5)` switches the LED ON and OFF.
- `HAL_Delay(500)` pauses the loop for 500 milliseconds.

{: .box-warning}
**Warning:** HAL_Delay() uses SysTick timer, so it may affect timing precision in time-critical applications.

---

##  Toggling GPIO using LL Drivers

Here’s the same example but written using **LL drivers** for better performance.

```c
#include "main.h"

int main(void)
{
  LL_Init1msTick(SystemCoreClock);
  LL_GPIO_SetPinMode(GPIOA, LL_GPIO_PIN_5, LL_GPIO_MODE_OUTPUT);

  while (1)
  {
    LL_GPIO_TogglePin(GPIOA, LL_GPIO_PIN_5);
    LL_mDelay(500);
  }
}
```

### LL vs HAL

| Feature | HAL | LL |
| :-- | :-- | :-- |
| Abstraction | High | Low |
| Code Size | Larger | Smaller |
| Speed | Slower | Faster |
| Ease of Use | Beginner Friendly | For Advanced Users |

{: .box-note}
If you’re just starting, begin with **HAL**, then move to **LL** for optimization.

---

##  Building and Running the Code

1. Connect your board via USB.
2. Click the **Run** (▶) button in STM32CubeIDE.
3. Watch the LED on **PA5** blink every 500ms!

---

##  Troubleshooting Tips

{: .box-error}
**Error:** LED doesn’t blink!  
**Fix:** Check that:
- The correct pin (PA5) is configured as **Output Push-Pull**.  
- System clock is properly initialized.  
- The LED is not externally connected to a different port.

---

##  Summary

| Concept | HAL Example | LL Example |
| :-- | :-- | :-- |
| Init | `MX_GPIO_Init()` | `LL_GPIO_SetPinMode()` |
| Toggle | `HAL_GPIO_TogglePin()` | `LL_GPIO_TogglePin()` |
| Delay | `HAL_Delay()` | `LL_mDelay()` |

---

##  Conclusion

{: .box-success}
You’ve just learned how to **toggle and control GPIO pins** in STM32 using both **HAL** and **LL** drivers!  
This fundamental skill will help you in future projects like:
- Controlling relays  
- Reading sensors  
- Driving displays or motors  

> The next step: try using a **button input** to control your LED instead of a timer loop!

---

![STM32F401 LED Blink](assets/img/Pi7_GIF_CMP.gif){: .mx-auto.d-block :}

<details markdown="1">
<summary>Click here to view bonus exercise</summary>
Try making the LED blink faster each time you press a button. Hint: use `HAL_GPIO_ReadPin()` for input reading!
</details>
